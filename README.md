# frontend

Запуск проекта:

    npm run svg
    npm run serve

# Поднятие в облаке

##РЕПОЗИТОРИИ НУЖНО ПОДНИМАТЬ ПО ОЧЕРЕДИ. ИНАЧЕ МОЖЕТ НЕ РАБОТАТЬ СИНХРОНИЗАЦИЯ КОДА НА БЕКЕНДЕ 

Сначала запускаем backend по инструкции ниже. Запущенным backend является тогда, когда появляется желтая надпись "Watching for changes..." и красные логи. Потом можно запускать фронт. Если не нужна синхронизация кода на беке можно запускать одновременно.

1) прежде всего нужно удалить весь кэш, который скорее всего остался после предыдущего окружения в папке с репозиторием. Он дает непредсказуемые результаты при деплое. В идеале нужно удалить репозиторий и склонировать заново.

2) нужно выполнить скрипт
```
 ./cloud-config.py -n <имя> .

```
  Этот скрипт сгенерирует конфигурацию для деплоя. Имя - ваше имя или любое другое слово, которое не будет пересекаться со словами коллег, потому что по этому имени вы будете переходить в локальное окружение (например введенное имя - zateevas, сгенерированный URL получится https://zateevas.phoenix.test01.maximumtest.ru). Выполнение данной команды требуется один раз.

3) Поднять базу командой:

```
Name=<имя> skaffold run -p postgres
```

4) запустить комманду 
```
Name=<имя> skaffold dev - если вы хотите, чтобы изменения трекались

Name=<имя> skaffold run - если вы хотите, чтобы приложение просто задеплоилось

```
Чтобы было понятней - если ты бекенд разработчик, то врядли ты будешь править фронтенд и тебе достаточно развернуть фронтенд командой run один раз и перезапускать его только в случае важных для тебя изменений на фронте. Изменения на беке же должны попадать в окружение сразу, поэтому бек тебе нужно запускать командой dev. Если ты тестировщик, то можешь запускать каждый раз командой run и все. Но помни, что запущенные окружения нужно иногда удалять командой helm delete --purge.


Через некоторое время проект задеплоится в облако. Понять, что проект задеплоился можно по надписям с красным прфиксом - это логи приложения. После этого можно переходить по ссылке https://<имя>.phoenix.test01.maximumtest.ru

##Немного информации для понимания как работать с окружениями:

Деплой окружения доступнен только через VPN. Смотреть на окружение можно из офиса без VPN, из дома только через VPN. 

Ваше окружение могут видеть все сотрудники компании, находящиеся в офисе и удаленные сотрудники через VPN. Это наверно можно как то использовать.

Фронтенд и Бекенд, которые должны работать вместе, должны иметь одинаковое имя, иначе магия не сработает. 

Все изменения, сохраненные в локальном репозитории должны в течение пары секунд поступать в облако. Если это не так прошу сообщать.

Так как база запускается командой run, она будет работать до тех пор, пока вы не введете команду helm delete --purge <имя>-test-backend-postgres

Выключить dev окружение можно командой Ctrl+C, при выключении окружения оно полностью удаляется из кластера.

Бывает такое, что работа dev окружения не завершилась корректно (Например сел ноутбук и поэтому Ctrl+C не было нажато). Ничего страшного, удалить окружение можно командой helm delete --purge <имя>-test-backend или <имя>-test-frontend. Если вы заново запустите окружение, а предыдущее не было мертво, то ничего страшного не случится, но что то может отработать не так как нужно. По возможности избегайте. Так же рекомендую так делать в случае, если что то пошло не так.

Можно одновременно запускать множество dev окружений, для этого достаточно склонить репозиторий еще раз, сконфигурировать с другим именем и запустить. Чтобы запустить множество обычных окружений, клонировать множество окружений не требуется, достаточно переключиться на нужну ветку и запустить деплой с командой run еще раз.  

Бывает так, что вы запустили окружение, но что то вспомнили и нажали Ctrl+C во время прокатки миграции. Job, отвечающий за миграцию, умрет сам собой через 5 минут, но пока он не умрет заново задеплоить не получится. Если неохото ждать, убить Job можно командой kubectl delete job backend-db-migrate-<имя>.phoenix.test01.maximumtest.ru -n phoenix

Все имеджи билдятся локально, рано или поздно имеджи будут забивать вам пямять. Если у вас нет нужных имеджей, удалить их можно командой docker rmi -f $(docker images -q)


# Полезные команды

docker rmi -f $(docker images -q) - очистить локальные имеджи

kubectl get pods - получить список всех подов (аналог docker ps)
kubectl get services -  получить список всех сервисов
kubectl exec -ti <имя_пода> bash - законнектиться в под (аналог docker exec)
kubectl port-forward <имя сервиса или пода> --address 0.0.0.0 <локальный порт>:<порт пода или сервиса> . Если это сервис, то перед названием нужно добавлять svc/ (например kubectl port-forward svc/staging-maximumtest-ru-frontend --address 0.0.0.0 8081:80 -n maximumtest)
helm list - показать окружения
helm delete --purge <имя окружения> - убить окружение
